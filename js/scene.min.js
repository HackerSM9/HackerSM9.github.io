!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Scene=e()}(this,function(){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function a(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var f=function(){return(f=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};var w="__SCENEJS_",o="animation-timing-function",u={transform:{},filter:{},attribute:{}},c={easing:[o]},g={"animation-timing-function":!0,contents:!0},E=1e-6,h="duration",C="fillMode",x="direction",O="iterationCount",D="delay",p="easing",I="playSpeed",d="easingName",l="paused",v="ended",m="timeupdate",y="animate",S="play",T="running",F="startAnimation",b="pauseAnimation",k="alternate",_="reverse",A="alternate-reverse",N="normal",M="infinite",P="playState",t=[h,C,x,O,D,p,I],e=[l,v,m,y,S,"iteration"],j="rgb",L="rgba",z="hsl",R="hsla",U=[j,L,z,R],V="function",q="property",K="array",$="object",i="string",r="number",s="undefined",Y=typeof window!==s,Z=["webkit","ms","moz","o"],H=function(t){if(typeof document===s)return"";var e=(document.body||document.documentElement).style,i=Z.length;if(typeof e[t]!==s)return t;for(var n=0;n<i;++n){var r="-"+Z[n]+"-"+t;if(typeof e[r]!==s)return r}return""},J=H("transform"),B=H("filter"),G=H("animation"),Q=G.replace("animation","keyframes");function W(t){return typeof t===s}function X(t){return t&&typeof t===$}function tt(t){return Array.isArray(t)}function et(t){return typeof t===i}function it(t){return typeof t===V}function nt(t){var e=t.match(/("[^"]*"|'[^']*'|[^,\s()]*\((?:[^()]*|\([^()]*\))*\)[^,\s()]*|[^,])+/g);return e?e.map(function(t){return t.trim()}):[]}function rt(t){var e=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(t);return!e||e.length<4?{}:{prefix:e[1],value:e[2],suffix:e[3]}}function st(t){var e=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(t);if(!e)return{prefix:"",unit:"",value:NaN};var i=e[1],n=e[2];return{prefix:i,unit:e[3],value:parseFloat(n)}}function at(t){return t.replace(/[\s-_]([a-z])/g,function(t,e){return e.toUpperCase()})}function ot(t,n){return void 0===n&&(n="-"),t.replace(/([a-z])([A-Z])/g,function(t,e,i){return""+e+n+i.toLowerCase()})}function ut(){return Date.now?Date.now():(new Date).getTime()}var ft=function(){var i=ut(),t=Y&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame);return t?t.bind(window):function(t){var e=ut();return window.setTimeout(function(){t(e-i)},1e3/60)}}();function ht(t){var e=t.replace("#",""),i=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16),s=parseInt(e.substring(6,8),16)/255;return isNaN(s)&&(s=1),[i,n,r,s]}function ct(t){if("#"===t.charAt(0))return 4===t.length||5===t.length?ht((f=(u=t).charAt(1),h=u.charAt(2),c=u.charAt(3),l=u.charAt(4),["#",f,f,h,h,c,c,l,l].join(""))):ht(t);if(-1!==t.indexOf("(")){var e=rt(t),i=e.prefix,n=e.value;if(!i||!n)return;var r=nt(n),s=[],a=r.length;switch(i){case j:case L:for(var o=0;o<a;++o)s[o]=parseFloat(r[o]);return s;case z:case R:for(o=0;o<a;++o)-1!==r[o].indexOf("%")?s[o]=parseFloat(r[o])/100:s[o]=parseFloat(r[o]);return function(t){var e=t[0],i=t[1],n=t[2];e<0&&(e+=360*Math.floor((Math.abs(e)+360)/360)),e%=360;var r,s=(1-Math.abs(2*n-1))*i,a=s*(1-Math.abs(e/60%2-1)),o=n-s/2;return e<60?r=[s,a,0]:e<120?r=[a,s,0]:e<180?r=[0,s,a]:e<240?r=[0,a,s]:e<300?r=[a,0,s]:e<360&&(r=[s,0,a]),[Math.round(255*(r[0]+o)),Math.round(255*(r[1]+o)),Math.round(255*(r[2]+o)),3<t.length?t[3]:1]}(s)}}var u,f,h,c,l}function lt(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function vt(t,e){if(t.classList)t.classList.remove(e);else{var i=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(i," ")}}function mt(t,e){return e.forEach(t),e}function pt(t,e){for(var i in e)t(e[i],i,e);return e}var dt=function(){function t(){this.events={}}var e=t.prototype;return e._on=function(n,r,i){var s=this,t=this.events;X(n)?pt(function(t,e){s._on(e,t,i)},n):(n in t||(t[n]=[]),r&&(tt(r)?mt(function(t){return s._on(n,t,i)},r):t[n].push(i?function t(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];r.apply(void 0,e),this.off(n,t)}:r)))},e.on=function(t,e){return this._on(t,e),this},e.off=function(t,e){if(t)if(e){var i=this.events[t];if(!i)return this;var n=i.indexOf(e);-1!==n&&i.splice(n,1)}else this.events[t]=[];else this.events={};return this},e.trigger=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var r=this.events;if(!(t in r))return this;var s=r[t];if(i.length){var a=i[0];a.type=t,a.currentTarget=this,!a.target&&(a.target=this)}return mt(function(t){t.apply(e,i)},s),this},e.once=function(t,e){return this._on(t,e,!0),this},t}();function gt(t,e,i){var n=1-i;return i*i*i+3*i*i*n*e+3*i*n*n*t}function yt(i,n,r,s){var t=function(t){var e=function(t,e,i){for(var n=i,r=1;.001<Math.abs(r);){if(r=gt(t,e,n)-i,Math.abs(r)<.001)return n;n-=r/2}return n}(i,r,Math.max(Math.min(1,t),0));return gt(n,s,e)};return t.easingName="cubic-bezier("+i+","+n+","+r+","+s+")",t}function St(i,n){var t=function(t){var e=1/i;return 1<=t?1:("start"===n?e:0)+Math.floor(t/e)*e};return t.easingName="steps("+i+", "+n+")",t}var Tt=St(1,"start"),wt=St(1,"end"),Ct=yt(0,0,1,1),Et=yt(.25,.1,.25,1),xt=yt(.42,0,1,1),Ot=yt(0,0,.58,1),Dt=yt(.42,0,.58,1),It=function(){function e(t,e){this.options={prefix:"",suffix:"",model:"",type:"",separator:","},e&&this.setOptions(e),this.init(t)}var t=e.prototype;return t.setOptions=function(t){var e=this.options;for(var i in t)e[i]=t[i];return e&&(this.options=f({},this.options,e)),this},t.getOption=function(t){return this.options[t]},t.size=function(){return this.value.length},t.get=function(t){return this.value[t]},t.set=function(t,e){return this.value[t]=e,this},t.clone=function(){return new e(this.value.map(function(t){return t instanceof e?t.clone():t}),this.options)},t.toValue=function(){return this.options.prefix+this.join()+this.options.suffix},t.join=function(){return this.value.map(function(t){return t instanceof e?t.toValue():t}).join(this.options.separator)},t.forEach=function(t){return this.value.forEach(t),this},t.init=function(t){var e=typeof t;return this.value=e===i?t.split(this.options.separator):e===$?t:[t],this},e}();function Ft(t){return t instanceof It}function bt(t){var e=typeof t;if(e===$){if(tt(t))return K;if(Ft(t))return q}else if(e===i||e===r)return"value";return e}function kt(t){return Math.round(1e6*t)/1e6}function _t(t,e,i){var n=e.length,r=t;if(0===n)return!1;for(var s=0;s<n;++s){if(!0===r)return!1;if(!(r=r[e[s]])||!i&&!0===r)return!1}return!0}function At(t,e){return _t(u,t,e)}function Nt(t,e){var i=w+"STYLE_"+jt(t),n=document.querySelector("#"+i);n?n.innerText=e:document.body.insertAdjacentHTML("beforeend",'<style id="'+i+'">'+e+"</style>")}function Mt(t){for(;;){var e=""+Math.floor(1e7*Math.random());if(!Y||!t)return e;if(!document.querySelector('[data-scene-id="'+e+'"]'))return e}}function Pt(t){return t.state.id||t.setId().getId()}function jt(t){return(""+t).match(/[0-9a-zA-Z]+/g).join("")}function Lt(t,e,i){if(void 0===i&&(i={}),G&&t.getPlayState()!==T){if((r=t).state.playCSS&&r.getPlayState()===l)t.addPlayClass(!0,i);else{t.isEnded()&&t.setTime(0),e&&t.exportCSS();var n=t.addPlayClass(!1,i);if(!n)return;!t.state.peusdo&&function(r,t){var s=r.getDuration(),a=!s||!isFinite(s),e=function(){a||(r.setState({playCSS:!1}),r.finish())};r.on(v,function(){t.removeEventListener("animationend",e),t.removeEventListener("animationiteration",i)});var i=function(t){var e=t.elapsedTime,i=e,n=a?0:i/s;r.state.currentTime=i,r.setCurrentIterationCount(n)};t.addEventListener("animationend",e),t.addEventListener("animationiteration",i)}(t,n),t.setState({playCSS:!0})}var r;t.setPlayState(T),t.trigger(S)}}function zt(t,e,i){return i===_||("infinite"!==e&&t===e&&e%1==0?i===(1<=t%2?A:k):i===(1<=t%2?k:A))}var Rt=[O,D,C,x,I,h,I,"iterationTime",P],Ut=Rt.concat([p,d]),Vt=function(i){function t(t){var e=i.call(this)||this;return e.options={},e.state={id:"",easing:0,easingName:"linear",iterationCount:1,delay:0,fillMode:"forwards",direction:N,playSpeed:1,currentTime:0,iterationTime:-1,currentIterationCount:0,tickTime:0,prevTime:0,playState:l,duration:0},e.setOptions(t),e}a(t,i);var e,n,r,s=t.prototype;return s.setEasing=function(t){var e=Array.isArray(t)?yt(t[0],t[1],t[2],t[3]):t,i=e[d]||"linear";return this.setState({easing:e,easingName:i}),this},s.setOptions=function(t){for(var e in void 0===t&&(t={}),t){var i=t[e];e!==p?e!==h?(e in this.state?this.state:this.options)[e]=i:i&&this.setDuration(i):this.setEasing(i)}return this},s.getTotalDuration=function(){return this.state[O]===M?1/0:this.state[D]+this.getActiveDuration()},s.getActiveDuration=function(){return this.state[O]===M?1/0:this.getDuration()*this.state[O]},s.isEnded=function(){return 0===this.state.tickTime&&this.state[P]===l||!(this.getTime()<this.getActiveDuration())},s.isPaused=function(){return this.state[P]===l},s.setNext=function(t){return this.on(v,function(){t.play()}),this},s.play=function(){var e=this;return this.state[P]=T,this.isEnded()&&this.setTickTime(0),this.state.tickTime=this.getTime(),ft(function(t){e.state.prevTime=t,e.tick(t)}),this.trigger(S),this},s.pause=function(){return this.state[P]=l,this.trigger(l),this},s.finish=function(){return this.state.tickTime=0,this.setTime(0),this.end(),this},s.end=function(){return this.pause(),this.trigger(v),this},s.setTime=function(t,e){var i=this.getActiveDuration(),n=e?t:this.getUnitTime(t);return this.state.tickTime=this.state.delay+n,n<0?n=0:i<n&&(n=i),this.state.currentTime=n,this.calculateIterationTime(),this.isDelay()||this.trigger(m,{currentTime:n,time:this.getIterationTime(),iterationCount:this.getIterationCount()}),this},s.getState=function(t){return this.state[t]},s.setState=function(t){for(var e in t)this.state[e]=t[e];return this},s.getTime=function(){return this.state.currentTime},s.getUnitTime=function(t){if(et(t)){var e=this.getDuration()||100;if("from"===t)return 0;if("to"===t)return e;var i=st(t),n=i.unit,r=i.value;return"%"===n?(!this.getDuration()&&(this.state.duration=e),parseFloat(t)/100*e):">"===n?r+E:r}return kt(t)},s.isDelay=function(){var t=this.state,e=t.delay,i=t.tickTime;return 0<e&&i<e},s.setCurrentIterationCount=function(t){var e=this.state,i=Math.floor(t);return e.currentIterationCount<i&&this.trigger("iteration",{currentTime:e.currentTime,iterationCount:i}),e.currentIterationCount=t,this},s.calculateIterationTime=function(){var t=this.state,e=t.iterationCount,i=t.fillMode,n=t.direction,r=this.getDuration(),s=this.getTime(),a=0===r?0:s/r,o=r?s%r:0;if(!r)return this.setIterationTime(0),this;this.setCurrentIterationCount(a);var u=zt(a,e,n),f=isFinite(r);(f&&u&&(o=r-o),f&&e!==M)&&(e<=a&&(o=r*("both"===i||"forwards"===i?e%1||1:0),u&&(o=r-o)));return this.setIterationTime(o),this},s.tick=function(t){var e=this,i=this.state,n=i.playSpeed,r=i.prevTime,s=this.state.tickTime+Math.min(1e3,t-r)/1e3*n;i.prevTime=t,this.setTickTime(s),this.isEnded()?this.end():i[P]!==l&&ft(function(t){e.tick(t)})},s.setTickTime=function(t){this.setTime(t-this.state.delay,!0)},t=function(t,e,i,n){var r,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;0<=o;o--)(r=t[o])&&(a=(s<3?r(a):3<s?r(e,i,a):r(e,i))||a);return 3<s&&a&&Object.defineProperty(e,i,a),a}([(e=Ut,n=Rt,r="state",function(t){var i=t.prototype;e.forEach(function(t){i[at("get "+t)]=function(){return this[r][t]}}),n.forEach(function(e){i[at("set "+e)]=function(t){return this[r][e]=t,this}})})],t)}(dt);function qt(t){var e=L;return 3===t.length&&(t[3]=1),new It(t,{model:e,separator:",",type:"color",prefix:e+"(",suffix:")"})}function Kt(t,e){return new It(t,{type:"array",separator:e})}function $t(t){if(!et(t))return Array.isArray(t)?Kt(t,","):t;var e,i,n=nt(t);return 1<n.length?Kt(n.map(function(t){return $t(t)}),","):1<(n=t.match(/("[^"]*")|('[^']*')|([^\s()]*(?:\((?:[^()]*|\([^()]*\))*\))[^\s()]*)|\S+/g)||[]).length?Kt(n.map(function(t){return $t(t)})," "):(n=/^(['"])([^'"]*)(['"])$/g.exec(t))&&n[1]===n[3]?new It([$t(n[2])],{prefix:n[1],suffix:n[1]}):-1!==t.indexOf("(")?function(t){var e=rt(t),i=e.prefix,n=e.value,r=e.suffix;if(void 0===n)return t;if(-1!==U.indexOf(i))return qt(ct(t));var s=$t(n),a=[n],o=",",u=i+"(",f=")"+r;return s instanceof It&&(o=s.getOption("separator"),a=s.value,u+=s.getOption("prefix"),f=s.getOption("suffix")+f),new It(a,{separator:o,model:i,prefix:u,suffix:f})}(t):"#"===t.charAt(0)?(i=ct(e=t))?qt(i):e:t}function Yt(t){if(!t)return"";var e=[];for(var i in t)e.push(i.replace(/\d/g,"")+"("+t[i]+")");return e.join(" ")}function Zt(t,e){return void 0===e&&(e=!1),Ht({},t,e)}function Ht(t,e,i){for(var n in void 0===i&&(i=!1),e){var r=e[n],s=bt(r);s===q?t[n]=i?r.toValue():r.clone():s===V?t[n]=i?Bt([n],r()):r:s===K?t[n]=r.slice():s===$?X(t[n])&&!Ft(t[n])?Ht(t[n],r,i):t[n]=Zt(r,i):t[n]=e[n]}return t}function Jt(t){return t[0]in c?c[t[0]]:t}function Bt(t,e){var i=bt(e);if(i===q)return e.toValue();if(i===V){if(t[0]!==o)return Bt(t,e())}else if(i===$)return Zt(e,!0);return e}var Gt=function(){function h(t){void 0===t&&(t={}),this.properties={},this.set(t)}var t=h.prototype;return t.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.raw.apply(this,t);return Bt(Jt(t),i)},t.raw=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this.properties,n=Jt(t),r=n.length,s=0;s<r;++s){if(!X(i))return;i=i[n[s]]}return i},t.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.properties,n=Jt(t),r=n.length;if(!r)return this;for(var s=0;s<r-1;++s){if(!X(i))return this;i=i[n[s]]}return delete i[n[r-1]],this},t.set=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.length,n=t.slice(0,-1),r=t[i-1];if(n[0]in c)this._set(c[n[0]],r);else if(2===i&&tt(n[0]))this._set(n[0],r);else if(X(r))if(tt(r))this._set(n,r);else if(Ft(r))At(n)?this.set.apply(this,n.concat([function e(t,i){void 0===i&&(i={});var n=t.getOption("model");if(n){t.setOptions({model:"",suffix:"",prefix:""});var r=1<t.size()?t:t.get(0);i[n]=r}else t.forEach(function(t){return e(t,i)});return i}(r)])):this._set(n,r);else if(r instanceof h)this.merge(r);else for(var s in r)this.set.apply(this,n.concat([s,r[s]]));else if(et(r)){if(At(n)){var a=$t(r);return X(a)&&this.set.apply(this,n.concat([a])),this}var o=function(t){for(var e=t.split(";"),i={},n=e.length,r=0;r<n;++r){var s=/([^:]*):([\S\s]*)/g.exec(e[r]);!s||s.length<3||!s[1]?--n:i[s[1].trim()]=$t(s[2].trim())}return{styles:i,length:n}}(r),u=o.styles,f=o.length;for(var s in u)this.set.apply(this,n.concat([s,u[s]]));if(f)return this;this._set(n,r)}else this._set(n,r);return this},t.has=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.properties,n=Jt(t),r=n.length;if(!r)return!1;for(var s=0;s<r;++s){if(!(X(i)&&n[s]in i))return!1;i=i[n[s]]}return!0},t.clone=function(){return(new h).merge(this)},t.merge=function(t){var e=this.properties,i=t.properties;return i&&Ht(e,i),this},t.toObject=function(){return Zt(this.properties,!0)},t.toCSSObject=function(){var t=this.toObject(),e={};for(var i in t)if(!At([i],!0)){var n=t[i];i!==o?e[i]=n:e[o.replace("animation",G)]=(et(n)?n:n.easingName)||"initial"}var r=Yt(t.transform),s=Yt(t.filter);return J&&r&&(e[J]=r),B&&s&&(e[B]=s),e},t.toCSS=function(){var t=this.toCSSObject(),e=[];for(var i in t)e.push(i+":"+t[i]+";");return e.join("")},t._set=function(t,e){for(var i=this.properties,n=t.length,r=0;r<n-1;++r){var s=t[r];!(s in i)&&(i[s]={}),i=i[s]}n&&(i[t[n-1]]=et(e)?$t(e):e)},h}();var Qt=function(){function t(){this.times=[],this.items={},this.names={}}var e=t.prototype;return e.getNames=function(){return function t(e,i){var n=[];for(var r in e)i.push(r),X(e[r])?n=n.concat(t(e[r],i)):n.push(i.slice()),i.pop();return n}(this.names,[])},e.hasName=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return _t(this.names,t,!0)},e.update=function(){var t=this.items;for(var e in t)this.updateFrame(t[e]);return this},e.forEach=function(e){var t=this.times,i=this.items;return t.forEach(function(t){e(i[t],t,i)}),this},e.updateFrame=function(t){if(!t)return this;var e=t.properties;return function t(e,i){for(var n in i){var r=i[n];!X(r)||tt(r)||r instanceof It?e[n]=!0:(X(e[n])||(e[n]={}),t(e[n],i[n]))}}(this.names,e),this},e.getDuration=function(){var t=this.times;return 0===t.length?0:t[t.length-1]},e.setDuration=function(t,e){void 0===e&&(e=this.getDuration());var i=t/e,n=this.times,r=this.items,s={};this.times=n.map(function(t){var e=kt(t*i);return s[e]=r[t],e}),this.items=s},e.unshift=function(i){var t=this.times,n=this.items,r={};return this.times=t.map(function(t){var e=kt(i+t);return r[e]=n[t],e}),this.items=r,this},e.size=function(){return this.times.length},e.add=function(t,e){return this.items[t]=e,this.addTime(t),this},e.has=function(t){return t in this.items},e.get=function(t){return this.items[t]},e.remove=function(t){return delete this.items[t],this.removeTime(t),this},e.addTime=function(t){for(var e=this.times,i=e.length,n=i,r=0;r<i;++r){if(t===e[r])return this;if(t<e[r]){n=r;break}}return this.times.splice(n,0,t),this},e.removeTime=function(t){var e=this.times.indexOf(t);return-1<e&&this.times.splice(e,1),this},t}();function Wt(t,i,n,r){if(0===r)return i;if(!tt(i))return t;var s=i.length;return t.map(function(t,e){return s<=e?t:te(t,i[e],n,r)})}function Xt(t,e,i,n){var r=t.getOption("type");if("color"===r)return function(t,e,i,n){if(0===n)return e;var r=t.value,s=e.value,a=t.getOption("model");if(a!==e.getOption("model"))return te(t.toValue(),e.toValue(),i,n);3===r.length&&(r[3]=1),3===s.length&&(s[3]=1);for(var o=Wt(r,s,i,n),u=a,f=0;f<3;++f)o[f]=parseInt(o[f],10);return new It(o,{type:"color",model:u,prefix:u+"(",suffix:")"})}(t,e,i,n);var s=Wt(t.value,e.value,i,n);return new It(s,{type:r,separator:t.getOption("separator")||e.getOption("separator"),prefix:t.getOption("prefix")||e.getOption("prefix"),suffix:t.getOption("suffix")||e.getOption("suffix"),model:t.getOption("model")||e.getOption("model")})}function te(t,e,i,n){if(0===n)return e;if(0===i||i+n===0)return t;var r=bt(t),s=bt(e),a=r===V,o=s===V;if(a||o)return function(){return te(a?$t(t()):t,o?$t(e()):e,i,n)};if(r!==s)return t;if(r===q)return Xt(t,e,i,n);if("array"===r)return Wt(t,e,i,n);if("value"!==r)return t;var u,f=i/(i+n),h=1-f,c=st(""+t),l=st(""+e);if(isNaN(c.value)||isNaN(l.value))return t;u=c.value*h+l.value*f;var v=c.prefix||l.prefix,m=c.unit||l.unit;return v||m?v+u+m:u}function ee(t){var e=[];for(var i in t)e.push(G+"-"+ot(i)+" : "+t[i]+";");return e.join("")}var ie=function(s){function v(t,e){var i=s.call(this)||this;return i.keyframes=new Qt,i.elements=[],i.load(t,e),i}a(v,s);var t=v.prototype;return t.getDuration=function(){return Math.max(this.state[h],this.keyframes.getDuration())},t.setDuration=function(t){if(0===t)return this;var e=this.getDuration();return 0<e&&this.keyframes.setDuration(t,e),s.prototype.setDuration.call(this,kt(t)),this},t.setId=function(t){var e=this.elements,i=e.length;this.setState({id:t||Mt(!!i)});var n=jt(this.getId());if(this.state.selector||(this.state.selector='[data-scene-id="'+n+'"]'),!i)return this;for(var r=0;r<i;++r)e[r].setAttribute("data-scene-id",n);return this},t.getId=function(){return this.state.id},t.set=function(e){for(var i=this,t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(X(e))return this.load(e),this;if(t[0]){if(t[0]instanceof v){var r=t[0],s=r.getDelay(),a=this.getUnitTime(e)+s,o=r.getAllTimes(!!s||!this.hasFrame(e)),u=o.keys,f=o.values,h=o.frames,c=this.getEasingName()!==r.getEasingName()?r.getEasing():0;return u.forEach(function(t){i.set(a+t,h[f[t]])}),c&&(this.set(a+u[0],p,c),this.set(a+u[u.length-1],p,"initial")),this}if(1===t.length&&tt(t[0]))return t[0].forEach(function(t){i.set(e,t)}),this}var l=this.newFrame(e);return l.set.apply(l,t),this.updateFrame(l),this},t.get=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.getFrame(t);return n&&n.get.apply(n,e)},t.remove=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.getFrame(t);return n&&n.remove.apply(n,e),this.update(),this},t.append=function(t){return this.set(this.getDuration(),t),this},t.prepend=function(t){if(t instanceof v){var e=t.getDelay(),i=(t.getIterationCount()===M?t.getDuration():t.getActiveDuration())+e,n=this.keyframes.get(0);n&&this.keyframes.remove(0),this.keyframes.unshift(i),this.set(0,t),this.set(i+E,n)}else this.prepend(new v(t));return this},t.setSelector=function(t){var e=this.state;e.selector=!0===t?e.id:t||'[data-scene-id="'+e.id+'"]';var i=/([\s\S]+)(:+[a-zA-Z]+)$/g.exec(e.selector);return i&&(e.selector=i[1],e.peusdo=i[2]),Y&&this.setElement(document.querySelectorAll(e.selector)),this},t.setElement=function(t){return t&&(this.elements=t instanceof Element?[t]:t,this.setId(this.getId())),this},t.setCSS=function(t,e){return this.set(t,function(t,e){if(!t||!e||!e.length)return{};var i;if(t instanceof Element)i=t;else{if(!t.length)return{};i=t[0]}for(var n={},r=window.getComputedStyle(i),s=e.length,a=0;a<s;++a)n[e[a]]=r[e[a]];return n}(this.elements,e)),this},t.animate=function(t,e){return s.prototype.setTime.call(this,t,!0),this._animate(e)},t.setTime=function(t,e,i){return s.prototype.setTime.call(this,t,e),this._animate(i),this},t.update=function(){return this.keyframes.update(),this},t.updateFrame=function(t){return this.keyframes.updateFrame(t),this},t.newFrame=function(t){var e=this.getFrame(t);return e||(e=new Gt,this.setFrame(t,e),e)},t.setFrame=function(t,e){return this.keyframes.add(this.getUnitTime(t),e),this.keyframes.update(),this},t.getFrame=function(t){return this.keyframes.get(this.getUnitTime(t))},t.hasFrame=function(t){return this.keyframes.has(this.getUnitTime(t))},t.removeFrame=function(t){var e=this.keyframes;return e.remove(t),e.update(),this},t.copyFrame=function(t,e){if(X(t)){for(var i in t)this.copyFrame(i,t[i]);return this}var n=this.getFrame(t);if(!n)return this;var r=n.clone();return this.setFrame(e,r),this},t.mergeFrame=function(t,e){if(X(t)){for(var i in t)this.mergeFrame(i,t[i]);return this}var n=this.getFrame(t);return n&&this.newFrame(e).merge(n),this},t.getNowFrame=function(i,t){var n=this,r=new Gt,e=this.keyframes.getNames(),s=this._getNearTimeIndex(i),a=s.left,o=s.right,u=this._getEasing(i,a,o,this.getEasing()||t);return e.forEach(function(t){var e=n._getNowValue(i,t,a,o,u);W(e)||r.set(t,e)}),r},t.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),tt(t))for(var i=t.length,n=0;n<i;++n){var r=1===i?0:this.getUnitTime(n/(i-1)*100+"%");this.set(r,t[n])}else if(t.keyframes)this.set(t.keyframes);else for(var r in t)if("options"!==r&&"keyframes"!==r){var s=t[r],a=this.getUnitTime(r);"number"!=typeof s?this.set(a,s):this.mergeFrame(s,a)}return e&&this.setOptions(e),this},t.clone=function(t){void 0===t&&(t={});var i=new v;return i.setOptions(this.state),i.setOptions(t),this.keyframes.forEach(function(t,e){return i.setFrame(e,t.clone())}),i},t.setOptions=function(t){void 0===t&&(t={}),s.prototype.setOptions.call(this,t);var e=t.id,i=t.selector,n=t.duration,r=t.elements;return n&&this.setDuration(n),e&&this.setId(e),r?this.setElement(r):i&&this.setSelector(!0===i?this.state.id:i),this},t.getAllTimes=function(t,e){void 0===t&&(t=!0),void 0===e&&(e={});var i=this.keyframes.times.slice(),n=i.length,r=[],s={};if(!n)return{keys:[],values:{},frames:{}};var a={},o=this.getDuration(),u=e[x]||this.state[x],f=u===k||u===A;!this.getFrame(0)&&i.unshift(0),!this.getFrame(o)&&i.push(o),n=i.length;for(var h=e[O]||this.state[O],c=(h=h!==M?h:1)*o,l=0;l<h;++l)for(var v=zt(l,h,u),m=l*o,p=0;p<n;++p)if(!f||0===l||0!==p){var d=0!==p||(0===l?t:f)?0:E,g=kt(v?i[n-1-p]:i[p]),y=kt(m+kt(v?o-g:g)+d);if(c<y)break;if(r.push(y),!a[s[y]=g]){var S=this.getFrame(g);if(S&&0!==p&&p!==n-1){a[g]=S.clone();var T=S.has("transform"),w=S.has("filter");if(T||w){var C=this.getNowFrame(g);T&&a[g].remove("transform").set("transform",C.raw("transform")),w&&a[g].remove("filter").set("filter",C.raw("filter"))}}else a[g]=this.getNowFrame(g)}}if(r[r.length-1]<c){g=kt(o*((v=zt(h,h,u))?1-h%1:h%1));r.push(c),!a[s[c]=g]&&(a[g]=this.getNowFrame(g))}return{keys:r,values:s,frames:a}},t.toCSS=function(t,e){void 0===t&&(t=this.getDuration()),void 0===e&&(e={});var i=this.state,n=i.selector||this.options.selector;if(!n)return"";var r=i.peusdo||"",s=Pt(this),a="infinite"===i[O],o=!W(e[O]),u=0===t,f=u?this.getDuration():t,h=e[I]||1,c=((e[D]||0)+(u?i[D]:0))/h,l=i[p]&&i[d]||o&&e[p]&&e[d]||i[d],v=a?"infinite":!u&&e[O]||i[O],m=ee({fillMode:"forwards"!==e[C]&&e[C]||i[C],direction:a?i[x]:e[x]||i[x],iterationCount:v,delay:c+"s",name:w+"KEYFRAMES_"+jt(s),duration:f/h+"s",timingFunction:l});return n+"."+F+r+" {\n\t\t\t"+m+"\n\t\t}"+n+"."+b+r+" {\n      "+G+"-play-state: paused;\n    }\n\t\t"+this._toKeyframes(f,!u&&o)},t.exportCSS=function(t,e){if(!this.elements.length)return"";var i=this.toCSS(t,e);return!(e&&!W(e[O]))&&Nt(Pt(this),i),i},t.pause=function(){return s.prototype.pause.call(this),this.isPausedCSS()&&this.pauseCSS(),this},t.isPausedCSS=function(){return this.state.playCSS&&this.isPaused()},t.pauseCSS=function(){var t=this.elements,e=t.length;if(!e)return this;for(var i=0;i<e;++i)lt(t[i],b)},t.endCSS=function(){var t=this.elements,e=t.length;if(!e)return this;for(var i=0;i<e;++i){var n=t[i];vt(n,b),vt(n,F)}this.setState({playCSS:!1})},t.end=function(){return!this.isEnded()&&this.state.playCSS&&this.endCSS(),s.prototype.end.call(this),this},t.playCSS=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e={}),Lt(this,t,e),this},t.addPlayClass=function(t,e){void 0===e&&(e={});var i=this.elements,n=i.length,r=ee(e);if(n){if(t)for(var s=0;s<n;++s)vt(i[s],b);else for(s=0;s<n;++s){var a=i[s];a.style.cssText+=r,u=F,((o=a).classList?o.classList.contains(u):o.className.match(new RegExp("(\\s|^)"+u+"(\\s|$)")))?(vt(a,F),function(t){ft(function(){ft(function(){lt(t,F)})})}(a)):lt(a,F)}var o,u;return i[0]}},t._getEasing=function(t,e,i,n){if(this.keyframes.hasName(o)){var r=this._getNowValue(t,[o],e,i,0,!0);return it(r)?r:n}return n},t._toKeyframes=function(i,t){void 0===i&&(i=this.getDuration());var e=Pt(this),n=this.state,r=n[I],s=n[O],a=n[C],o=t?n[D]:0,u=t?n[x]:N,f=u===_||u===A,h=this.getAllTimes(!0,{duration:i,delay:o,direction:u,iterationCount:t&&s!==M?s:1,isCSS:!0}),c=h.keys,l=h.values,v=h.frames,m=c.length,p={},d=[];if(!c.length)return"";for(var g in v)p[g]=v[g].toCSS();var y=c[m-1],S=p[l[y]];if(o){var T=!f||"both"!==a&&"backwards"!==a?p[0]:S;d.push("0%{}"),f&&d.push(o/r/i*100-E+"%{"+T+"}")}return c.forEach(function(t){var e=(o+t)/r/i*100;d.push(e+"%{"+(0===e?"":p[l[t]])+"}")}),(o+y)/r<i&&d.push("100%{"+S+"}"),"@"+Q+" "+w+"KEYFRAMES_"+jt(e)+"{\n\t\t\t"+d.join("\n")+"\n\t\t}"},t._getNowValue=function(t,e,i,n,r,s){void 0===r&&(r=this.getEasing()),void 0===s&&(s=_t(g,e,!0));for(var a,o,u,f,h=this.keyframes,c=h.times,l=c.length,v=i;0<=v;--v){if((p=h.get(c[v])).has.apply(p,e)){a=c[v],u=p;break}}var m=u&&u.raw.apply(u,e);if(s)return m;for(v=n;v<l;++v){var p;if((p=h.get(c[v])).has.apply(p,e)){o=c[v],f=p;break}}var d=f&&f.raw.apply(f,e);return!u||W(m)?d:!f||W(d)||m===d?m:(a<0&&(a=0),function(t,e,i,n,r,s){if(t===e)return n;if(t===i)return r;if(!s)return te(n,r,t-e,i-t);var a=s((t-e)/(i-e));return te(n,r,a,1-a)}(t,a,o,m,d,r))},t._getNearTimeIndex=function(t){for(var e=this.keyframes.times,i=e.length,n=0;n<i;++n){if(e[n]===t)return{left:n,right:n};if(e[n]>t)return{left:0===n?0:n-1,right:n}}return{left:i-1,right:i-1}},t._animate=function(t){var e=this.getIterationTime(),i=this.getEasing()||t,n=this.getNowFrame(e,i),r=this.getTime();this.trigger("animate",{frame:n,currentTime:r,time:e});var s=this.elements,a=s.length;if(!a||this.state.peusdo)return n;var o=n.get("attribute");if(o)for(var u in o)for(var f=0;f<a;++f)s[f].setAttribute(u,o[u]);var h=n.toCSS();if(this.state.cssText!==h){this.state.cssText=h;for(f=0;f<a;++f)s[f].style.cssText+=h;return n}},v}(Vt),ne=function(n){function c(t,e){var i=n.call(this)||this;return i.items={},i.load(t,e),i}a(c,n);var t=c.prototype;return t.setId=function(t){return void 0===t&&(t="scene"+Math.floor(1e5*Math.random())),this.state.id=t,this},t.getId=function(){return this.state.id},t.getDuration=function(){var t=this.items,e=0;for(var i in t){var n=t[i];e=Math.max(e,n.getTotalDuration()/n.getPlaySpeed())}return e},t.setDuration=function(t){var e=this.items,i=this.getDuration();if(0===t||!isFinite(i))return this;if(0===i)for(var n in e){(s=e[n]).setDuration(t)}else{var r=t/i;for(var n in e){var s;(s=e[n]).setDelay(s.getDelay()*r),s.setDuration(s.getDuration()*r)}}return this},t.getItem=function(t,e){return null!=e?this.items[t].getItem(e):this.items[t]},t.newItem=function(t,e){if(void 0===e&&(e={}),!(t in this.items)){var i=new ie;return this.setItem(t,i),i.setOptions(e),i}},t.setItem=function(t,e){return e.setId(t),this.items[t]=e,this},t.animate=function(t,e){return n.prototype.setTime.call(this,t,!0),this._animate(e)},t.setTime=function(t,e,i){return n.prototype.setTime.call(this,t,e),this._animate(i),this},t.forEach=function(t){return pt(t,this.items),this},t.toCSS=function(t,e){void 0===t&&(t=this.getDuration());var i=this.items,n=e?this.getDuration():t;n&&isFinite(n)||(n=0);var r=[],s=f({},this.state);if(e){var a=s[O],o=e[O];"infinite"===o?s[O]="infinite":"infinite"!==a&&(s[O]=a*o),s[p]||(s[p]=e[p],s[d]=e[d])}for(var u in i)r.push(i[u].toCSS(n,s));return r.join("")},t.exportCSS=function(t,e){var i=this.toCSS(t,e);return!e&&Nt(Pt(this),i),i},t.append=function(t){t.setDelay(t.getDelay()+this.getDuration()),this.setItem(Pt(t),t)},t.isPausedCSS=function(){return this.state.playCSS&&this.isPaused()},t.pauseCSS=function(){var t=this.items;for(var e in t)t[e].pauseCSS()},t.pause=function(){return n.prototype.pause.call(this),this.isPausedCSS()&&this.pauseCSS(),this},t.endCSS=function(){var t=this.items;for(var e in t)t[e].endCSS();this.setState({playCSS:!1})},t.end=function(){return!this.isEnded()&&this.state.playCSS&&this.endCSS(),n.prototype.end.call(this),this},t.addPlayClass=function(t,e){void 0===e&&(e={});var i,n=this.items;for(var r in n){var s=n[r].addPlayClass(t,e);!i&&(i=s)}return i},t.playCSS=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e={}),Lt(this,t,e),this},t.set=function(t){void 0===t&&(t={});for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.load(t)},t.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),!t)return this;var i=e&&e.selector||this.options.selector;for(var n in t)if("options"!==n){var r=t[n],s=void 0;if(r instanceof c||r instanceof ie)this.setItem(n,r),s=r;else{if(it(r)&&i){for(var a=Y?document.querySelectorAll(n):[],o=a.length,u=new c,f=0;f<o;++f){var h=Mt();u.newItem(""+f,{id:h,selector:'[data-scene-id="'+h+'"]',elements:a[f]}).load(r(f))}this.setItem(n,u);continue}(s=this.newItem(n)).load(r)}i&&s.setSelector(n)}this.setOptions(e)},t.setSelector=function(t){var i=this.options.selector;this.forEach(function(t,e){t.setSelector(!!i&&e)})},t._animate=function(t){var e=this.getIterationTime(),i=this.items,n=this.getEasing()||t,r={};for(var s in i){var a=i[s];r[s]=a.animate(Math.max(e*a.getPlaySpeed()-a.getDelay(),0),n)}return this.trigger(y,{currentTime:this.getTime(),time:e,frames:r}),r},c.VERSION="1.0.0-beta13",c}(Vt);function re(t,e,i){for(var n=new ie({},i),r=e.length,s=0;s<r;++s)n.set(s/(r-1)*100+"%",t,e[s]);return n}var se={SceneItem:ie,Frame:Gt,Animator:Vt,Keyframes:Qt,PropertyObject:It,default:ne,bezier:yt,EASE_IN_OUT:Dt,EASE_IN:xt,EASE_OUT:Ot,EASE:Et,LINEAR:Ct,steps:St,STEP_START:Tt,STEP_END:wt,set:re,transition:function(t,e,i){var n,r,s=i.from,a=i.to,o=i.duration,u=void 0===o?t.getDuration():o,f=i.time,h=void 0===f?Math.max(t.getDuration()-u,0):f;t.set(((n={})[h]=s,n[h+u]=a,n)),e.set(((r={0:a})[u]=s,r))},wipeIn:function(t){var e=t.from,i=void 0===e?"-100%":e,n=t.to,r=void 0===n?"0%":n,s=t.property;return re(void 0===s?"left":s,[i,r],t)},wipeOut:function(t){var e=t.from,i=void 0===e?"0%":e,n=t.to,r=void 0===n?"100%":n,s=t.property;return re(void 0===s?"left":s,[i,r],t)},fadeIn:function(t){var e=t.from,i=void 0===e?0:e,n=t.to;return re("opacity",[i,void 0===n?1:n],t)},fadeOut:function(t){var e=t.from,i=void 0===e?1:e,n=t.to;return re("opacity",[i,void 0===n?0:n],t)},blink:function(t){var e=t.from,i=void 0===e?0:e,n=t.to;return re("opacity",[i,void 0===n?1:n,i],t)},zoomIn:function(t){var e=t.from,i=void 0===e?0:e,n=t.to;return re(["transform","scale"],[i,void 0===n?1:n],t)},zoomOut:function(t){var e=t.from,i=void 0===e?1:e,n=t.to;return re(["transform","scale"],[i,void 0===n?0:n],t)},OPTIONS:t,EVENTS:e,setRole:function(t,e,i){for(var n=t.length,r=u,s=g,a=0;a<n-1;++a)!r[t[a]]&&(r[t[a]]={}),r=r[t[a]],i&&(!s[t[a]]&&(s[t[a]]={}),s=s[t[a]]);i&&(s[t[n-1]]=!0),r[t[n-1]]=!!e||{}},setAlias:function(t,e){c[t]=e}};for(var ae in se)ne[ae]=se[ae];return ne});
//# sourceMappingURL=scene.min.js.map
